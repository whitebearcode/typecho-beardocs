(function(h,f){var l={};wp.media.coerce=function(a,d){f.isUndefined(a[d])&&!f.isUndefined(this.defaults[d])?a[d]=this.defaults[d]:"true"===a[d]?a[d]=!0:"false"===a[d]&&(a[d]=!1);return a[d]};wp.media.string={props:function(a,d){var b=wp.media.view.settings.defaultProps;a=a?f.clone(a):{};d&&d.type&&(a.type=d.type);"image"===a.type&&(a=f.defaults(a||{},{align:b.align||getUserSetting("align","none"),size:b.size||getUserSetting("imgsize","medium"),url:"",classes:[]}));if(!d)return a;a.title=a.title||
d.title;b=a.link||b.link||getUserSetting("urlbutton","file");if("file"===b||"embed"===b)var c=d.url;else"post"===b?c=d.link:"custom"===b&&(c=a.linkUrl);a.linkUrl=c||"";"image"===d.type?(a.classes.push("wp-image-"+d.id),c=(c=d.sizes)&&c[a.size]?c[a.size]:d,f.extend(a,f.pick(d,"align","caption","alt"),{width:c.width,height:c.height,src:c.url,captionId:"attachment_"+d.id})):"video"===d.type||"audio"===d.type?f.extend(a,f.pick(d,"title","type","icon","mime")):(a.title=a.title||d.filename,a.rel=a.rel||
"attachment wp-att-"+d.id);return a},link:function(a,d){a=wp.media.string.props(a,d);d={tag:"a",content:a.title,attrs:{href:a.linkUrl}};a.rel&&(d.attrs.rel=a.rel);return wp.html.string(d)},audio:function(a,d){return wp.media.string._audioVideo("audio",a,d)},video:function(a,d){return wp.media.string._audioVideo("video",a,d)},_audioVideo:function(a,d,b){d=wp.media.string.props(d,b);if("embed"!==d.link)return wp.media.string.link(d);var c={};"video"===a&&(b.image&&-1===b.image.src.indexOf(b.icon)&&
(c.poster=b.image.src),b.width&&(c.width=b.width),b.height&&(c.height=b.height));var e=b.filename.split(".").pop();if(f.contains(wp.media.view.settings.embedExts,e))c[e]=b.url;else return wp.media.string.link(d);return wp.shortcode.string({tag:a,attrs:c})},image:function(a,d){var b={};a.type="image";a=wp.media.string.props(a,d);var c=a.classes||[];b.src=f.isUndefined(d)?a.url:d.url;f.extend(b,f.pick(a,"width","height","alt"));a.align&&!a.caption&&c.push("align"+a.align);a.size&&c.push("size-"+a.size);
b["class"]=f.compact(c).join(" ");d={tag:"img",attrs:b,single:!0};a.linkUrl&&(d={tag:"a",attrs:{href:a.linkUrl},content:d});c=wp.html.string(d);a.caption&&(d={},b.width&&(d.width=b.width),a.captionId&&(d.id=a.captionId),a.align&&(d.align="align"+a.align),c=wp.shortcode.string({tag:"caption",attrs:d,content:c+" "+a.caption}));return c}};wp.media.embed={coerce:wp.media.coerce,defaults:{url:"",width:"",height:""},edit:function(a,d){var b={};d?b.url=a.replace(/<[^>]+>/g,""):(a=wp.shortcode.next("embed",
a).shortcode,b=f.defaults(a.attrs.named,this.defaults),a.content&&(b.url=a.content));return wp.media({frame:"post",state:"embed",metadata:b})},shortcode:function(a){var d=this;f.each(this.defaults,function(c,e){a[e]=d.coerce(a,e);c===a[e]&&delete a[e]});var b=a.url;delete a.url;return new wp.shortcode({tag:"embed",attrs:a,content:b})}};wp.media.collection=function(a){var d={};return f.extend({coerce:wp.media.coerce,attachments:function(b){var c=b.string(),e=d[c],g=this;delete d[c];if(e)return e;b=
f.defaults(b.attrs.named,this.defaults);c=f.pick(b,"orderby","order");c.type=this.type;c.perPage=-1;void 0!==b.orderby&&(b._orderByField=b.orderby);"rand"===b.orderby&&(b._orderbyRandom=!0);if(!b.orderby||/^menu_order(?: ID)?$/i.test(b.orderby))c.orderby="menuOrder";b.ids?(c.post__in=b.ids.split(","),c.orderby="post__in"):b.include&&(c.post__in=b.include.split(","));b.exclude&&(c.post__not_in=b.exclude.split(","));c.post__in||(c.uploadedTo=b.id);var k=f.omit(b,"id","ids","include","exclude","orderby",
"order");f.each(this.defaults,function(n,m){k[m]=g.coerce(k,m)});b=wp.media.query(c);b[this.tag]=new Backbone.Model(k);return b},shortcode:function(b){var c=b.props.toJSON(),e=f.pick(c,"orderby","order");b.type&&(e.type=b.type,delete b.type);b[this.tag]&&f.extend(e,b[this.tag].toJSON());e.ids=b.pluck("id");c.uploadedTo&&(e.id=c.uploadedTo);delete e.orderby;e._orderbyRandom?e.orderby="rand":e._orderByField&&"rand"!==e._orderByField&&(e.orderby=e._orderByField);delete e._orderbyRandom;delete e._orderByField;
e.ids&&"post__in"===e.orderby&&delete e.orderby;e=this.setDefaults(e);e=new wp.shortcode({tag:this.tag,attrs:e,type:"single"});c=new wp.media.model.Attachments(b.models,{props:c});c[this.tag]=b[this.tag];d[e.string()]=c;return e},edit:function(b){var c=wp.shortcode.next(this.tag,b),e=this.defaults.id;if(c&&c.content===b){c=c.shortcode;f.isUndefined(c.get("id"))&&!f.isUndefined(e)&&c.set("id",e);b=this.attachments(c);var g=new wp.media.model.Selection(b.models,{props:b.props.toJSON(),multiple:!0});
g[this.tag]=b[this.tag];g.more().done(function(){g.props.set({query:!1});g.unmirror();g.props.unset("orderby")});this.frame&&this.frame.dispose();c=c.attrs.named.type&&"video"===c.attrs.named.type?"video-"+this.tag+"-edit":this.tag+"-edit";return this.frame=wp.media({frame:"post",state:c,title:this.editTitle,editing:!0,multiple:!0,selection:g}).open()}},setDefaults:function(b){var c=this;f.each(this.defaults,function(e,g){b[g]=c.coerce(b,g);e===b[g]&&delete b[g]});return b}},a)};wp.media._galleryDefaults=
{itemtag:"dl",icontag:"dt",captiontag:"dd",columns:"3",link:"post",size:"thumbnail",order:"ASC",id:wp.media.view.settings.post&&wp.media.view.settings.post.id,orderby:"menu_order ID"};wp.media.galleryDefaults=wp.media.view.settings.galleryDefaults?f.extend({},wp.media._galleryDefaults,wp.media.view.settings.galleryDefaults):wp.media._galleryDefaults;wp.media.gallery=new wp.media.collection({tag:"gallery",type:"image",editTitle:wp.media.view.l10n.editGalleryTitle,defaults:wp.media.galleryDefaults,
setDefaults:function(a){var d=this,b=!f.isEqual(wp.media.galleryDefaults,wp.media._galleryDefaults);f.each(this.defaults,function(c,e){a[e]=d.coerce(a,e);c!==a[e]||b&&c!==wp.media._galleryDefaults[e]||delete a[e]});return a}});wp.media.featuredImage={get:function(){return wp.media.view.settings.post.featuredImageId},set:function(a){var d=wp.media.view.settings;d.post.featuredImageId=a;wp.media.post("get-post-thumbnail-html",{post_id:d.post.id,thumbnail_id:d.post.featuredImageId,_wpnonce:d.post.nonce}).done(function(b){"0"===
b?window.alert(wp.i18n.__("Could not set that as the thumbnail image. Try a different attachment.")):h(".inside","#postimagediv").html(b)})},remove:function(){wp.media.featuredImage.set(-1)},frame:function(){if(this._frame)return wp.media.frame=this._frame;this._frame=wp.media({state:"featured-image",states:[new wp.media.controller.FeaturedImage,new wp.media.controller.EditImage]});this._frame.on("toolbar:create:featured-image",function(a){this.createSelectToolbar(a,{text:wp.media.view.l10n.setFeaturedImage})},
this._frame);this._frame.on("content:render:edit-image",function(){var a=this.state("featured-image").get("selection");a=(new wp.media.view.EditImage({model:a.single(),controller:this})).render();this.content.set(a);a.loadEditor()},this._frame);this._frame.state("featured-image").on("select",this.select);return this._frame},select:function(){var a=this.get("selection").single();wp.media.view.settings.post.featuredImageId&&wp.media.featuredImage.set(a?a.id:-1)},init:function(){h("#postimagediv").on("click",
"#set-post-thumbnail",function(a){a.preventDefault();a.stopPropagation();wp.media.featuredImage.frame().open()}).on("click","#remove-post-thumbnail",function(){wp.media.featuredImage.remove();return!1})}};h(wp.media.featuredImage.init);wp.media.editor={insert:function(a){var d,b=!f.isUndefined(window.tinymce),c=!f.isUndefined(window.QTags);var e=this.activeEditor?window.wpActiveEditor=this.activeEditor:window.wpActiveEditor;if(window.send_to_editor)return window.send_to_editor.apply(this,arguments);
if(e)b&&(d=tinymce.get(e));else if(b&&tinymce.activeEditor)d=tinymce.activeEditor,e=window.wpActiveEditor=d.id;else if(!c)return!1;d&&!d.isHidden()?d.execCommand("mceInsertContent",!1,a):c?QTags.insertContent(a):document.getElementById(e).value+=a;if(window.tb_remove)try{window.tb_remove()}catch(g){}},add:function(a,d){var b=this.get(a);if(b)return b;b=l[a]=wp.media(f.defaults(d||{},{frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0}));b.on("insert",function(c){var e=b.state();
(c=c||e.get("selection"))&&h.when.apply(h,c.map(function(g){var k=e.display(g).toJSON();return this.send.attachment(k,g.toJSON())},this)).done(function(){wp.media.editor.insert(f.toArray(arguments).join("\n\n"))})},this);b.state("gallery-edit").on("update",function(c){this.insert(wp.media.gallery.shortcode(c).string())},this);b.state("playlist-edit").on("update",function(c){this.insert(wp.media.playlist.shortcode(c).string())},this);b.state("video-playlist-edit").on("update",function(c){this.insert(wp.media.playlist.shortcode(c).string())},
this);b.state("embed").on("select",function(){var c=b.state(),e=c.get("type");c=c.props.toJSON();c.url=c.url||"";"link"===e?(f.defaults(c,{linkText:c.url,linkUrl:c.url}),this.send.link(c).done(function(g){wp.media.editor.insert(g)})):"image"===e&&(f.defaults(c,{title:c.url,linkUrl:"",align:"none",link:"none"}),"none"===c.link?c.linkUrl="":"file"===c.link&&(c.linkUrl=c.url),this.insert(wp.media.string.image(c)))},this);b.state("featured-image").on("select",wp.media.featuredImage.select);b.setState(b.options.state);
return b},id:function(a){if(a)return a;a=window.wpActiveEditor;a||f.isUndefined(window.tinymce)||!tinymce.activeEditor||(a=tinymce.activeEditor.id);return a||""},get:function(a){a=this.id(a);return l[a]},remove:function(a){a=this.id(a);delete l[a]},send:{attachment:function(a,d){var b=d.caption;wp.media.view.settings.captions||delete d.caption;a=wp.media.string.props(a,d);var c={id:d.id,post_content:d.description,post_excerpt:b};a.linkUrl&&(c.url=a.linkUrl);"image"===d.type?(d=wp.media.string.image(a),
f.each({align:"align",size:"image-size",alt:"image_alt"},function(e,g){a[g]&&(c[e]=a[g])})):"video"===d.type?d=wp.media.string.video(a,d):"audio"===d.type?d=wp.media.string.audio(a,d):(d=wp.media.string.link(a),c.post_title=a.title);return wp.media.post("send-attachment-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,attachment:c,html:d,post_id:wp.media.view.settings.post.id})},link:function(a){return wp.media.post("send-link-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,
src:a.linkUrl,link_text:a.linkText,html:wp.media.string.link(a),post_id:wp.media.view.settings.post.id})}},open:function(a,d){d=d||{};this.activeEditor=a=this.id(a);var b=this.get(a);if(!b||b.options&&d.state!==b.options.state)b=this.add(a,d);wp.media.frame=b;return b.open()},init:function(){h(document.body).on("click.add-media-button",".insert-media",function(a){var d=h(a.currentTarget),b=d.data("editor"),c={frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0};a.preventDefault();
d.hasClass("gallery")&&(c.state="gallery",c.title=wp.media.view.l10n.createGalleryTitle);wp.media.editor.open(b,c)});(new wp.media.view.EditorUploader).render()}};f.bindAll(wp.media.editor,"open");h(wp.media.editor.init)})(jQuery,_);
